<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Asisten Gesture - Play & Pause</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>

  <style>
    body {
      margin: 0; padding: 0; overflow: hidden;
      font-family: sans-serif; background: #1a1a1a; color: white;
      display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh;
    }
    
    /* Kamera di pojok */
    video#input_video {
      position: absolute; bottom: 20px; right: 20px;
      width: 240px; border-radius: 10px; transform: scaleX(-1);
      border: 2px solid #00ffcc; opacity: 0.8; z-index: 10;
    }

    /* Video yang akan dikontrol */
    #media-player {
      width: 640px; border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 4px solid #333; transition: border-color 0.3s;
    }

    #status-overlay {
      position: absolute; font-size: 80px; font-weight: bold;
      color: rgba(255, 255, 255, 0.8); pointer-events: none;
      text-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: opacity 0.3s;
      opacity: 0;
    }

    #info {
      position: absolute; top: 20px; left: 20px; font-size: 18px;
      background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px;
    }
  </style>
</head>

<body>
  <div id="info">
    <b>Panduan Asisten:</b><br>
    ✌️ Angkat <b>2 Jari (Telunjuk & Tengah)</b> untuk Play / Pause video.<br>
    <span id="gesture-status" style="color: #00ffcc;">Menunggu gerakan...</span>
  </div>
  
  <video id="media-player" src="https://www.w3schools.com/html/mov_bbb.mp4" loop></video>
  <div id="status-overlay">▶️ PLAY</div>

  <video id="input_video" autoplay playsinline></video>

  <script type="module">
    const videoElement = document.getElementById('input_video');
    const mediaPlayer = document.getElementById('media-player');
    const statusOverlay = document.getElementById('status-overlay');
    const gestureStatus = document.getElementById('gesture-status');

    // Mencegah Play/Pause terpanggil berkali-kali dalam 1 detik
    let lastToggleTime = 0;
    const cooldownMs = 1500; // 1.5 detik jeda antar perintah

    function showOverlay(text) {
      statusOverlay.innerText = text;
      statusOverlay.style.opacity = 1;
      setTimeout(() => { statusOverlay.style.opacity = 0; }, 1000);
    }

    function togglePlayPause() {
      const currentTime = new Date().getTime();
      // Cek apakah waktu sekarang sudah melewati masa cooldown
      if (currentTime - lastToggleTime > cooldownMs) {
        if (mediaPlayer.paused) {
          mediaPlayer.play();
          showOverlay("▶️ PLAY");
          mediaPlayer.style.borderColor = "#00ffcc"; // Warna border nyala
        } else {
          mediaPlayer.pause();
          showOverlay("⏸️ PAUSE");
          mediaPlayer.style.borderColor = "#ff3366"; // Warna border merah
        }
        lastToggleTime = currentTime; // Reset waktu cooldown
      }
    }

    function onResults(results) {
      if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        const landmarks = results.multiHandLandmarks[0];

        // Mendapatkan posisi Y (Tinggi) dari ujung jari dan buku jari
        // Semakin kecil nilai Y, posisinya semakin di atas layar
        const isIndexUp = landmarks[8].y < landmarks[6].y;   // Telunjuk naik
        const isMiddleUp = landmarks[12].y < landmarks[10].y; // Jari Tengah naik
        const isRingDown = landmarks[16].y > landmarks[14].y; // Jari Manis turun
        const isPinkyDown = landmarks[20].y > landmarks[18].y; // Kelingking turun

        // Logika V-Sign (Hanya telunjuk dan tengah yang naik)
        if (isIndexUp && isMiddleUp && isRingDown && isPinkyDown) {
          gestureStatus.innerText = "Gestur Terdeteksi: ✌️ V-SIGN";
          togglePlayPause();
        } else {
          gestureStatus.innerText = "Menganalisa jari...";
        }
      } else {
        gestureStatus.innerText = "Tangan tidak terlihat.";
      }
    }

    const hands = new Hands({locateFile: (file) => {
      return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
    }});

    hands.setOptions({
      maxNumHands: 1,
      modelComplexity: 1,
      minDetectionConfidence: 0.7,
      minTrackingConfidence: 0.7
    });
    hands.onResults(onResults);

    const camera = new Camera(videoElement, {
      onFrame: async () => {
        await hands.send({image: videoElement});
      },
      width: 640,
      height: 480
    });
    camera.start();
  </script>
</body>
</html>
